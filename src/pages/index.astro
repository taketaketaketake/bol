---
import Layout from '../layout/Layout.astro';
import ZipChecker from '../components/ZipChecker';
import WelcomeDiscount from '../components/WelcomeDiscount';
import { supabase } from '../lib/supabase';

// Environment variables - Astro way
const mapboxToken = import.meta.env.PUBLIC_MAPBOX_ACCESS_TOKEN;
const supabaseUrl = import.meta.env.PUBLIC_SUPABASE_URL;
const imageBaseUrl = `${supabaseUrl}/storage/v1/object/public/bol-images`;

// Check if user is logged in and get their profile data
const { cookies } = Astro;
const accessToken = cookies.get('sb-access-token');
const refreshToken = cookies.get('sb-refresh-token');

let userAddress = '';
let userPhone = '';

if (accessToken && refreshToken) {
  const { data: { session } } = await supabase.auth.setSession({
    access_token: accessToken.value,
    refresh_token: refreshToken.value
  });

  if (session?.user) {
    const metadata = session.user.user_metadata || {};
    userAddress = metadata.address || '';
    userPhone = metadata.phone || '';
  }
}

// Date calculations
const today = new Date();
const minDate = today.toISOString().split('T')[0];
const maxDate = new Date();
maxDate.setMonth(maxDate.getMonth() + 6);
const maxDateString = maxDate.toISOString().split('T')[0];

// SEO Meta
const title = "Laundry Pickup & Delivery in Detroit | Bags of Laundry";
const description = "Professional laundry pickup & delivery in Detroit. Wash & fold, dry cleaning, and commercial services with same-day options available.";
const ogImage = "https://hjkefmlxjyonfjxewkko.supabase.co/storage/v1/object/public/bol-images/bags_of_laundry_vehicle%20(1).png";
---

<Layout title={title} description={description} ogImage={ogImage}>
  <!-- Welcome Discount Modal -->
  <WelcomeDiscount client:load />

  <div class="min-h-screen bg-brand-bg">

    <!-- HERO SECTION -->
    <section class="pt-0 pb-8 sm:pb-12 lg:pb-24 relative overflow-hidden">
      <!-- Background Image -->
      <div class="absolute inset-0 z-0">
        <div class="absolute inset-0 bg-gradient-to-r from-white/95 via-white/85 to-white/70"></div>
        <img
          src="https://images.unsplash.com/photo-1582735689369-4fe89db7114c?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80"
          alt="Clean laundry background"
          class="w-full h-full object-cover opacity-20"
          loading="eager"
        />
      </div>

      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <div class="grid lg:grid-cols-2 gap-8 lg:gap-12 items-start lg:items-center">

          <!-- Hero Content -->
          <div class="order-2 lg:order-1">
            <div class="pill mb-4 sm:mb-6">Detroit • Pickup & Delivery</div>
            <h1 class="text-2xl sm:text-3xl lg:text-4xl xl:text-5xl font-extrabold tracking-tight text-brand-text mb-4 sm:mb-6">
              Laundry day, done. <span class="text-brand-primary">Start your order.</span>
            </h1>
            <p class="text-base sm:text-lg sub mb-6 sm:mb-8 leading-relaxed">
              We pick up, professionally clean (wash & fold or dry clean), and deliver back fresh—often within 24 hours. Serving Detroit & nearby suburbs.
            </p>
          </div>

          <!-- Order Form - Mobile First -->
          <div class="order-1 lg:order-2 mt-8 sm:mt-0 mb-8 sm:mb-0">
            <div class="hero bg-white border border-gray-200 shadow-lg">
              <h2 class="text-lg sm:text-xl font-bold text-brand-text mb-4 sm:mb-6">Start Your Laundry Order</h2>
              <form method="POST" action="/start-basic" class="space-y-4 sm:space-y-5">

                <!-- Address - Full width on mobile -->
                <div class="relative">
                  <label for="addr" class="block text-sm font-semibold text-brand-text mb-2">
                    Pickup Address or ZIP*
                  </label>
                  <input
                    id="addr"
                    name="line1"
                    type="text"
                    placeholder="e.g., 123 Main St or 48226"
                    value={userAddress}
                    required
                    class="input text-base sm:text-sm h-12 sm:h-10"
                    autocomplete="off"
                  />
                  <p class="text-xs sub mt-1">We serve ~30 miles from Downtown Detroit</p>
                </div>

                <!-- Phone and Date - Responsive layout -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-4">
                  <div>
                    <label for="phone" class="block text-sm font-semibold text-brand-text mb-2">
                      Mobile*
                    </label>
                    <input
                      id="phone"
                      name="phone"
                      type="tel"
                      placeholder="(313) 555-0123"
                      value={userPhone}
                      required
                      pattern="[0-9\s\(\)\-]{10,14}"
                      title="Please enter a valid phone number"
                      maxlength="14"
                      class="input text-base sm:text-sm h-12 sm:h-10"
                    />
                  </div>
                  <div>
                    <label for="date" class="block text-sm font-semibold text-brand-text mb-2">
                      Pickup Date*
                    </label>
                    <input
                      id="date"
                      name="date"
                      type="date"
                      min={minDate}
                      max={maxDateString}
                      required
                      class="input text-base sm:text-sm h-12 sm:h-10"
                    />
                  </div>
                </div>

                <!-- Hidden fields for compatibility with start-basic -->
                <input type="hidden" name="sameAsPickup" value="on" />
                <input type="hidden" name="timeWindow" value="" />

                <!-- Buttons - Stacked on mobile, inline on desktop -->
                <div class="flex flex-col sm:flex-row gap-3 pt-2 sm:pt-4">
                  <button class="btn text-base sm:text-sm h-12 sm:h-auto flex-1 sm:flex-none" type="submit">
                    Continue →
                  </button>
                  <a class="btn-alt text-base sm:text-sm h-12 sm:h-auto flex-1 sm:flex-none text-center" href="/pricing">
                    View Pricing
                  </a>
                </div>

                <p class="text-xs sub pt-2 text-center sm:text-left">
                  By continuing, you agree to our <a href="/terms" class="text-brand-primary hover:underline">Terms</a> & <a href="/privacy" class="text-brand-primary hover:underline">Privacy</a>.
                </p>
              </form>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- TRUST BELT -->
    <section class="border-y border-brand-line bg-white/50">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8">
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6">
          <div class="flex items-center gap-3">
            <div class="w-5 h-5 sm:w-6 sm:h-6 bg-brand-accent text-white rounded-full flex items-center justify-center text-xs sm:text-sm font-bold">✓</div>
            <span class="text-xs sm:text-sm text-brand-text font-medium">On-time pickup windows</span>
          </div>
          <div class="flex items-center gap-3">
            <div class="w-5 h-5 sm:w-6 sm:h-6 bg-brand-accent text-white rounded-full flex items-center justify-center text-xs sm:text-sm font-bold">✓</div>
            <span class="text-xs sm:text-sm text-brand-text font-medium">Order tracking & text updates</span>
          </div>
          <div class="flex items-center gap-3">
            <div class="w-5 h-5 sm:w-6 sm:h-6 bg-brand-accent text-white rounded-full flex items-center justify-center text-xs sm:text-sm font-bold">✓</div>
            <span class="text-xs sm:text-sm text-brand-text font-medium">Sensitive-skin options</span>
          </div>
          <div class="flex items-center gap-3">
            <div class="w-5 h-5 sm:w-6 sm:h-6 bg-brand-accent text-white rounded-full flex items-center justify-center text-xs sm:text-sm font-bold">✓</div>
            <span class="text-xs sm:text-sm text-brand-text font-medium">Licensed & insured</span>
          </div>
        </div>
      </div>
    </section>

    <!-- SERVICES -->
    <section class="py-8 sm:py-12 lg:py-24 bg-brand-bg">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="section-title text-center text-brand-text mb-8 sm:mb-12">Laundry services made for Detroit</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 sm:gap-8">

          <article class="card overflow-hidden">
            <div class="w-full overflow-hidden" style="aspect-ratio: 1 / 1;">
              <img
                src="https://hjkefmlxjyonfjxewkko.supabase.co/storage/v1/object/public/bol-images/bags_of_laundry_folded_laundry_square.jpg"
                alt="Wash and fold laundry neatly folded"
                class="w-full h-full object-cover object-top"
              />
            </div>
            <div class="p-4 sm:p-6">
              <h3 class="text-lg sm:text-xl font-bold text-brand-text mb-2 sm:mb-3">Wash & Fold</h3>
              <p class="sub mb-3 sm:mb-4 text-sm sm:text-base">Everyday laundry washed, dried, and folded to your preferences—delivered back ready to put away.</p>
              <a class="btn-alt w-full sm:w-auto" href="/services#washfold">Learn more</a>
            </div>
          </article>

          <article class="card overflow-hidden">
            <div class="w-full overflow-hidden" style="aspect-ratio: 1 / 1;">
              <img
                src="https://hjkefmlxjyonfjxewkko.supabase.co/storage/v1/object/public/bol-images/spirit_of_detroit_laundry%20(2).png"
                alt="Dry cleaning garments on hangers"
                class="w-full h-full object-cover"
              />
            </div>
            <div class="p-4 sm:p-6">
              <h3 class="text-lg sm:text-xl font-bold text-brand-text mb-2 sm:mb-3">Laundry Pickup & Delivery</h3>
              <p class="sub mb-3 sm:mb-4 text-sm sm:text-base">Professional care for suits, dresses, uniforms, and delicates—pickup & delivery included.</p>
              <a class="btn-alt w-full sm:w-auto" href="/services#drycleaning">Learn more</a>
            </div>
          </article>

          <article class="card overflow-hidden">
            <div class="w-full overflow-hidden" style="aspect-ratio: 1 / 1;">
              <img
                src="https://hjkefmlxjyonfjxewkko.supabase.co/storage/v1/object/public/bol-images/bags_of_laundry_manager_in_commercial_facility.png"
                alt="Commercial client towels and linens"
                class="w-full h-full object-cover"
              />
            </div>
            <div class="p-4 sm:p-6">
              <h3 class="text-lg sm:text-xl font-bold text-brand-text mb-2 sm:mb-3">Commercial Laundry</h3>
              <p class="sub mb-3 sm:mb-4 text-sm sm:text-base">Reliable solutions for Airbnbs, gyms, salons, restaurants, and offices—volume pricing available.</p>
              <a class="btn-alt w-full sm:w-auto" href="/commercial-laundry">Learn more</a>
            </div>
          </article>

          <article class="card overflow-hidden bg-gradient-to-br from-orange-50 to-blue-50 border-2 border-brand-primary">
            <div class="w-full overflow-hidden" style="aspect-ratio: 1 / 1;">
              <img
                src="https://hjkefmlxjyonfjxewkko.supabase.co/storage/v1/object/public/bol-images/commercial-washers.png"
                alt="Partner laundromat washers"
                class="w-full h-full object-cover"
              />
            </div>
            <div class="p-4 sm:p-6">
              <div class="inline-block bg-brand-primary text-white rounded-full px-3 py-1 text-xs font-bold mb-2">
                For Laundromats
              </div>
              <h3 class="text-lg sm:text-xl font-bold text-brand-text mb-2 sm:mb-3">Partner With Us</h3>
              <p class="sub mb-3 sm:mb-4 text-sm sm:text-base">Fill your machines during off-peak hours. $0 startup costs, $0 monthly fees.</p>
              <a class="btn w-full sm:w-auto" href="/laundromat-partners">Learn more</a>
            </div>
          </article>

        </div>
      </div>
    </section>

    <!-- PROCESS -->
    <section class="py-8 sm:py-12 lg:py-24 bg-white">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid lg:grid-cols-2 gap-8 sm:gap-12 items-center">
          <div>
            <img
              src="https://hjkefmlxjyonfjxewkko.supabase.co/storage/v1/object/public/bol-images/bags_of_laundry_vehicle%20(1).png"
              alt="Driver picking up laundry bags from customer doorstep"
              class="rounded-xl border border-brand-line w-full shadow-soft"
            />
          </div>
          <div>
            <h2 class="section-title text-brand-text mb-4 sm:mb-6">How pickup & delivery works</h2>
            <div class="space-y-4 sm:space-y-6 text-brand-text">
              <div class="flex gap-3 sm:gap-4">
                <div class="w-8 h-8 sm:w-10 sm:h-10 bg-brand-primary text-white rounded-full flex items-center justify-center text-base sm:text-lg font-bold flex-shrink-0">1</div>
                <div>
                  <h3 class="font-semibold mb-1 sm:mb-2 text-base sm:text-lg">Schedule</h3>
                  <p class="sub text-sm sm:text-base">Book a pickup window online. Save detergent & folding preferences.</p>
                </div>
              </div>
              <div class="flex gap-3 sm:gap-4">
                <div class="w-8 h-8 sm:w-10 sm:h-10 bg-brand-primary text-white rounded-full flex items-center justify-center text-base sm:text-lg font-bold flex-shrink-0">2</div>
                <div>
                  <h3 class="font-semibold mb-1 sm:mb-2 text-base sm:text-lg">We collect</h3>
                  <p class="sub text-sm sm:text-base">Place your bags at the door. We scan, weigh, and track every order.</p>
                </div>
              </div>
              <div class="flex gap-3 sm:gap-4">
                <div class="w-8 h-8 sm:w-10 sm:h-10 bg-brand-primary text-white rounded-full flex items-center justify-center text-base sm:text-lg font-bold flex-shrink-0">3</div>
                <div>
                  <h3 class="font-semibold mb-1 sm:mb-2 text-base sm:text-lg">Fresh delivery</h3>
                  <p class="sub text-sm sm:text-base">Clothes return clean and neatly folded—often within 24 hours.</p>
                </div>
              </div>
            </div>
            <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 mt-6 sm:mt-8">
              <a class="btn w-full sm:w-auto" href="/start-basic">Schedule Pickup</a>
              <a class="btn-alt w-full sm:w-auto" href="/pricing">See Pricing</a>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- SERVICE AREAS with Interactive Component -->
    <section class="py-8 sm:py-12 lg:py-28 bg-brand-bg relative">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="section-title text-center text-brand-text mb-4 sm:mb-6">
          Where we pick up & deliver
        </h2>
        <p class="text-center sub mb-8 sm:mb-12">
          Serving Detroit and nearby suburbs within ~30 miles of Downtown
        </p>

        <!-- ZIP Code Search -->
        <div class="max-w-xl mx-auto mb-8 sm:mb-16">
          <ZipChecker mapboxToken={mapboxToken} client:load />
        </div>

        <!-- AREA CARDS -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6">
          <!-- Detroit -->
          <div class="card p-4 sm:p-6 hover:shadow-2xl transition rounded-2xl border border-gray-200 bg-white">
            <h3 class="text-base sm:text-lg font-bold text-brand-text mb-2 sm:mb-3">Detroit</h3>
            <p class="sub text-xs sm:text-sm mb-3 sm:mb-4">
              Downtown, Midtown, Corktown, New Center, Eastern Market
            </p>
            <div class="flex flex-wrap gap-2">
              <span class="pill">48226</span>
              <span class="pill">48201</span>
              <span class="pill">48216</span>
              <span class="pill">48202</span>
              <span class="pill">48207</span>
            </div>
          </div>

          <!-- Royal Oak -->
          <div class="card p-4 sm:p-6 hover:shadow-2xl transition rounded-2xl border border-gray-200 bg-white">
            <h3 class="text-base sm:text-lg font-bold text-brand-text mb-2 sm:mb-3">Royal Oak</h3>
            <p class="sub text-xs sm:text-sm mb-3 sm:mb-4">
              Downtown, Woodward Corners, Vinsetta
            </p>
            <div class="flex flex-wrap gap-2">
              <span class="pill">48067</span>
              <span class="pill">48073</span>
            </div>
          </div>

          <!-- Dearborn -->
          <div class="card p-4 sm:p-6 hover:shadow-2xl transition rounded-2xl border border-gray-200 bg-white">
            <h3 class="text-base sm:text-lg font-bold text-brand-text mb-2 sm:mb-3">Dearborn</h3>
            <p class="sub text-xs sm:text-sm mb-3 sm:mb-4">
              East/West Dearborn, Aviation Sub
            </p>
            <div class="flex flex-wrap gap-2">
              <span class="pill">48124</span>
              <span class="pill">48126</span>
              <span class="pill">48127</span>
            </div>
          </div>

          <!-- More -->
          <div class="card p-4 sm:p-6 hover:shadow-2xl transition rounded-2xl border border-gray-200 bg-white flex flex-col justify-between">
            <div>
              <h3 class="text-base sm:text-lg font-bold text-brand-text mb-2 sm:mb-3">More</h3>
              <p class="sub text-xs sm:text-sm mb-3 sm:mb-4">
                Ferndale, Grosse Pointe, Warren, Southfield, Troy, Livonia, Canton
              </p>
            </div>
            <a
              class="btn-alt mt-3 sm:mt-4 inline-block text-center w-full"
              href="/service-areas"
            >
              See all areas
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- TESTIMONIALS -->
    <section class="py-8 sm:py-12 lg:py-24 bg-white">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="section-title text-center text-brand-text mb-8 sm:mb-12">What customers say</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 sm:gap-8">

          <blockquote class="card p-4 sm:p-6 relative">
            <svg class="absolute top-4 right-4 w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
              <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
            </svg>
            <div class="flex gap-1 mb-3">
              <span style="color: #FBBF24; font-size: 1.25rem;">★</span>
              <span style="color: #FBBF24; font-size: 1.25rem;">★</span>
              <span style="color: #FBBF24; font-size: 1.25rem;">★</span>
              <span style="color: #FBBF24; font-size: 1.25rem;">★</span>
              <span style="color: #FBBF24; font-size: 1.25rem;">★</span>
            </div>
            <p class="text-brand-text mb-3 sm:mb-4 text-sm sm:text-base">"Pickup right on time and everything came back perfectly folded. Huge time saver."</p>
            <div class="flex items-center gap-3">
              <img src="https://hjkefmlxjyonfjxewkko.supabase.co/storage/v1/object/public/bol-images/bags_testimonal_1.png" alt="Samantha L." class="w-10 h-10 rounded-full object-cover" />
              <div>
                <p class="text-brand-text font-semibold text-xs sm:text-sm">Samantha L.</p>
                <p class="sub text-xs">Detroit</p>
              </div>
            </div>
          </blockquote>

          <blockquote class="card p-4 sm:p-6 relative">
            <svg class="absolute top-4 right-4 w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
              <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
            </svg>
            <div class="flex gap-1 mb-3">
              <span style="color: #FBBF24; font-size: 1.25rem;">★</span>
              <span style="color: #FBBF24; font-size: 1.25rem;">★</span>
              <span style="color: #FBBF24; font-size: 1.25rem;">★</span>
              <span style="color: #FBBF24; font-size: 1.25rem;">★</span>
              <span style="color: #FBBF24; font-size: 1.25rem;">★</span>
            </div>
            <p class="text-brand-text mb-3 sm:mb-4 text-sm sm:text-base">"We run an Airbnb and rely on them weekly. Zero misses and excellent communication."</p>
            <div class="flex items-center gap-3">
              <img src="https://hjkefmlxjyonfjxewkko.supabase.co/storage/v1/object/public/bol-images/bags_testimonal_3.png" alt="James R." class="w-10 h-10 rounded-full object-cover" />
              <div>
                <p class="text-brand-text font-semibold text-xs sm:text-sm">James R.</p>
                <p class="sub text-xs">Host</p>
              </div>
            </div>
          </blockquote>

          <blockquote class="card p-4 sm:p-6 relative">
            <svg class="absolute top-4 right-4 w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
              <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
            </svg>
            <div class="flex gap-1 mb-3">
              <span style="color: #FBBF24; font-size: 1.25rem;">★</span>
              <span style="color: #FBBF24; font-size: 1.25rem;">★</span>
              <span style="color: #FBBF24; font-size: 1.25rem;">★</span>
              <span style="color: #FBBF24; font-size: 1.25rem;">★</span>
              <span style="color: #FBBF24; font-size: 1.25rem;">★</span>
            </div>
            <p class="text-brand-text mb-3 sm:mb-4 text-sm sm:text-base">"Thanks for bailing me out. Was not looking forward to wearing dirty clothes tomorrow."</p>
            <div class="flex items-center gap-3">
              <img src="https://hjkefmlxjyonfjxewkko.supabase.co/storage/v1/object/public/bol-images/bags_testimonial_2.png" alt="Mitch S." class="w-10 h-10 rounded-full object-cover" />
              <div>
                <p class="text-brand-text font-semibold text-xs sm:text-sm">Mitch S.</p>
                <p class="sub text-xs">Pilot</p>
              </div>
            </div>
          </blockquote>
        </div>
      </div>
    </section>

    <!-- FAQ -->
    <section class="py-8 sm:py-12 lg:py-24 bg-brand-bg">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="section-title text-center text-brand-text mb-8 sm:mb-12">Frequently asked questions</h2>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">

          <div class="card p-4 sm:p-6">
            <h3 class="text-base sm:text-lg font-bold text-brand-text mb-2 sm:mb-3">Do you offer same-day service?</h3>
            <p class="sub text-sm sm:text-base">Yes—choose an early pickup window and select "same-day" at checkout when available.</p>
          </div>

          <div class="card p-4 sm:p-6">
            <h3 class="text-base sm:text-lg font-bold text-brand-text mb-2 sm:mb-3">Can I set detergent and folding preferences?</h3>
            <p class="sub text-sm sm:text-base">Absolutely. Save your preferences in your account or specify them at scheduling—we'll follow them every time.</p>
          </div>

          <div class="card p-4 sm:p-6">
            <h3 class="text-base sm:text-lg font-bold text-brand-text mb-2 sm:mb-3">Do you serve businesses and short-term rentals?</h3>
            <p class="sub text-sm sm:text-base">Yes. We handle linens, towels, uniforms, and more with flexible pickups and volume pricing.</p>
          </div>

          <div class="card p-4 sm:p-6">
            <h3 class="text-base sm:text-lg font-bold text-brand-text mb-2 sm:mb-3">What areas do you cover?</h3>
            <p class="sub text-sm sm:text-base">Detroit core and suburbs within ~30 miles: Royal Oak, Dearborn, Ferndale, Grosse Pointe, Warren, Southfield, Troy, Livonia, Canton, and more.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- FINAL CTA -->
    <section class="py-8 sm:py-12 lg:py-24 bg-white">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="card p-6 sm:p-8 lg:p-12 text-center">
          <h2 class="section-title text-brand-text mb-3 sm:mb-4">Ready to skip laundry day?</h2>
          <p class="sub mb-6 sm:mb-8">Start your order now or view transparent pricing.</p>
          <div class="flex flex-col sm:flex-row justify-center gap-3 sm:gap-4">
            <a class="btn w-full sm:w-auto" href="/start-basic">Start Order</a>
            <a class="btn-alt w-full sm:w-auto" href="/pricing">View Pricing</a>
          </div>
        </div>
      </div>
    </section>
  </div>
</Layout>

<script define:vars={{ mapboxToken }}>
  // Address autocomplete setup
  function setupAddressAutocomplete() {
    console.log("Setting up address autocomplete");
    const input = document.getElementById('addr');
    console.log("Found input element:", input);
    if (!input || input.dataset.autocompleteInitialized) {
      console.log("Input not found or already initialized");
      return;
    }

    input.dataset.autocompleteInitialized = "true";
    console.log("Autocomplete initialized for input");

    let debounceTimer;
    let suggestionsList = null;

    const removeSuggestions = () => {
      if (suggestionsList) {
        suggestionsList.remove();
        suggestionsList = null;
      }
    };

    const showSuggestions = (suggestions, showNoResults = false) => {
      removeSuggestions();
      suggestionsList = document.createElement("div");
      suggestionsList.className =
        "absolute top-full left-0 right-0 bg-white border border-gray-300 rounded-xl shadow-lg z-50 max-h-60 overflow-y-auto mt-1";

      if (suggestions.length === 0 && showNoResults) {
        const noResultsItem = document.createElement("div");
        noResultsItem.className = "px-4 py-3 text-gray-500 text-sm";
        noResultsItem.textContent =
          "No addresses found. Service area limited to Michigan.";
        suggestionsList.appendChild(noResultsItem);
      } else if (suggestions.length > 0) {
        suggestions.forEach((suggestion) => {
          const item = document.createElement("div");
          item.className =
            "px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0";
          item.textContent = suggestion.place_name;

          item.addEventListener("click", () => {
            input.value = suggestion.place_name;
            removeSuggestions();
          });

          suggestionsList.appendChild(item);
        });
      } else {
        return;
      }

      input.parentElement.style.position = "relative";
      input.parentElement.appendChild(suggestionsList);
    };

    const searchAddresses = async (query) => {
      if (query.length < 3) {
        removeSuggestions();
        return;
      }
      console.log("Searching for:", query);
      try {
        const url = `https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(
          query
        )}.json?access_token=${mapboxToken}&country=US&types=address,poi&limit=5&bbox=-90.4180,41.6962,-82.4137,48.3063`;
        console.log("API URL:", url);
        const response = await fetch(url);
        console.log("Response status:", response.status);
        const data = await response.json();
        console.log("API Response:", data);
        showSuggestions(data.features || [], query.length >= 10);
      } catch (error) {
        console.error("Address search error:", error);
      }
    };

    input.addEventListener("input", (e) => {
      const query = e.target.value;
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(() => searchAddresses(query), 300);
    });

    input.addEventListener("blur", () => {
      setTimeout(removeSuggestions, 150);
    });
  }

  // Phone formatting
  function setupPhoneFormatting() {
    const phoneInputs = document.querySelectorAll('input[type="tel"]');

    phoneInputs.forEach((input) => {
      const phoneInput = input;

      const formatPhoneNumber = (value) => {
        const phoneNumber = value.replace(/\D/g, '');

        if (phoneNumber.length >= 6) {
          return `(${phoneNumber.slice(0, 3)}) ${phoneNumber.slice(3, 6)}-${phoneNumber.slice(6, 10)}`;
        } else if (phoneNumber.length >= 3) {
          return `(${phoneNumber.slice(0, 3)}) ${phoneNumber.slice(3)}`;
        } else {
          return phoneNumber;
        }
      };

      phoneInput.addEventListener('input', (e) => {
        const target = e.target;
        const formatted = formatPhoneNumber(target.value);
        target.value = formatted;
      });

      phoneInput.addEventListener('blur', (e) => {
        const target = e.target;
        target.setCustomValidity('');
      });
    });
  }

  // Initialize when DOM is loaded
  document.addEventListener('DOMContentLoaded', () => {
    setupAddressAutocomplete();
    setupPhoneFormatting();
  });
</script>