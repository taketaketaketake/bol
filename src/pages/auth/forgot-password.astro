---
export const prerender = false;
import Layout from '../../layout/Layout.astro';
import ForgotPasswordForm from '../../components/auth/ForgotPasswordForm';
import { supabase } from '../../lib/supabase';

const { cookies } = Astro;
const accessToken = cookies.get('sb-access-token');
const refreshToken = cookies.get('sb-refresh-token');

const { data: { session } } = await supabase.auth.setSession({
  access_token: accessToken?.value || '',
  refresh_token: refreshToken?.value || ''
});

if (session) {
  return Astro.redirect('/dashboard');
}
---

<Layout title="Forgot Password">
  <main class="min-h-screen bg-brand-bg flex flex-col justify-center py-12 sm:px-6 lg:px-8">
    <div class="sm:mx-auto sm:w-full sm:max-w-md">
      <a href="/" class="flex justify-center mb-6">
        <div class="text-2xl font-bold text-brand-primary">Bags of Laundry</div>
      </a>
      <h2 class="text-center text-3xl font-extrabold text-brand-text">
        Reset your password
      </h2>
      <p class="mt-2 text-center text-sm text-brand-muted">
        Enter your email and we'll send you a reset link
      </p>
    </div>

    <div class="mt-8 mx-auto w-full" style="max-width: 400px;">
      <div class="bg-white py-8 px-8 shadow-lg border border-gray-200 rounded-lg">
        <ForgotPasswordForm client:load />
      </div>
    </div>
  </main>
</Layout>
