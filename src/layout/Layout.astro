---
import SiteHeader from '../components/SiteHeader';
import '../styles/app.css';
import { getSession } from '../utils/auth';

export interface Props {
  title?: string;
  description?: string;
  ogImage?: string;
  noIndex?: boolean;
}

const {
  title = "Bags of Laundry",
  description = "Professional laundry and dry cleaning services",
  ogImage = "/og-image.jpg",
  noIndex = false
} = Astro.props;

// Get session automatically in Layout
const session = await getSession(Astro.cookies);

const currentPath = Astro.url.pathname;
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const siteUrl = Astro.site || 'https://bagsoflaundry.com';

// Structured data for local business
const structuredData = {
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "name": "Bags of Laundry",
  "description": "Professional laundry pickup and delivery service in Detroit and Metro suburbs",
  "url": siteUrl,
  "telephone": "+1-313-555-0123", // Replace with real number
  "email": "hello@bagsoflaundry.com", // Replace with real email
  "address": {
    "@type": "PostalAddress",
    "addressLocality": "Detroit",
    "addressRegion": "MI",
    "addressCountry": "US"
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": "42.3314",
    "longitude": "-83.0458"
  },
  "serviceArea": {
    "@type": "GeoCircle",
    "geoMidpoint": {
      "@type": "GeoCoordinates",
      "latitude": "42.3314",
      "longitude": "-83.0458"
    },
    "geoRadius": "48280" // ~30 miles in meters
  },
  "services": [
    "Laundry pickup and delivery",
    "Wash and fold service",
    "Dry cleaning",
    "Commercial laundry",
    "Same-day rush service"
  ],
  "priceRange": "$2.49 per pound",
  "openingHours": "Mo-Su 06:00-22:00",
  "areaServed": [
    "Detroit, MI",
    "Royal Oak, MI",
    "Dearborn, MI",
    "Ferndale, MI",
    "Grosse Pointe, MI",
    "Warren, MI",
    "Southfield, MI",
    "Troy, MI",
    "Livonia, MI",
    "Canton, MI"
  ]
};
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Primary Meta Tags -->
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="keywords" content="laundry pickup delivery Detroit, wash fold dry cleaning Michigan, commercial laundry Detroit" />

    <!-- Canonical URL -->
    <link rel="canonical" href={canonicalURL} />

    <!-- Robots -->
    {noIndex && <meta name="robots" content="noindex, nofollow" />}

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={new URL(ogImage, siteUrl)} />
    <meta property="og:locale" content="en_US" />
    <meta property="og:site_name" content="Bags of Laundry" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={canonicalURL} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={new URL(ogImage, siteUrl)} />

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />

    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- Structured Data -->
    <script type="application/ld+json" set:html={JSON.stringify(structuredData)} />

    <!-- Additional meta for local business -->
    <meta name="geo.region" content="US-MI" />
    <meta name="geo.placename" content="Detroit, Michigan" />
    <meta name="geo.position" content="42.3314;-83.0458" />
    <meta name="ICBM" content="42.3314, -83.0458" />
  </head>
  <body>
    <SiteHeader session={session} currentPath={currentPath} client:load />
    <slot />
  </body>
</html>
